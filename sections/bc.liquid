{% comment %}
Section: Box Customizer for Shopify
A single-file section including inline styles and scripts to implement a 3â€‘step gift box builder that matches the provided design.
Place this file in your theme under /sections/box-customizer.liquid and attach it to a page template.
{% endcomment %}

<div class="box-customizer">
  <!-- ICON NAV -->
  <div class="customizer-icons">
    <div class="icon-step active" data-step="1">
      <img src="{{ 'icon-packaging.svg' | asset_url }}" alt="Pick your giftbox">
      <p>PICK YOUR GIFTBOX</p>
    </div>
    <div class="icon-step" data-step="2">
      <img src="{{ 'icon-gifts.svg' | asset_url }}" alt="Choose your gifts">
      <p>CHOOSE YOUR GIFTS</p>
    </div>
    <div class="icon-step" data-step="3">
      <img src="{{ 'icon-card.svg' | asset_url }}" alt="Pick a card">
      <p>PICK A CARD</p>
    </div>
    <div class="icon-step" data-step="4">
      <img src="{{ 'icon-enjoy.svg' | asset_url }}" alt="Enjoy gifting">
      <p>ENJOY GIFTING</p>
    </div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="customizer-progress">
    <div class="progress-line"></div>
    {% for i in (1..4) %}
      <div class="progress-step{% if i == 1 %} active{% endif %}" data-step="{{ i }}">
        <span class="step-label">
          {% case i %}
            {% when 1 %}STEP 1<br>Packaging
            {% when 2 %}STEP 2<br>Gifts
            {% when 3 %}STEP 3<br>Card
            {% when 4 %}DONE<br>Done!
          {% endcase %}
        </span>
      </div>
    {% endfor %}
  </div>

  <!-- STEP CONTENT -->
  <div class="customizer-content">
    <!-- STEP 1 -->
    <div class="step-content" id="step-1">
      <p class="small-label">STEP 1 OF 3</p>
      <h2>CHOOSE YOUR BOX COLOR</h2>
      <p class="description">Welcome to the easiest way to send someone a custom gift, in 3 simple steps. Add to cart and repeat for multiple boxes, or update your quantity in the cart.</p>
      <div class="box-options">
        {% for block in section.blocks %}
          {% if block.type == 'box_color' %}
            <div class="option-item" data-block-id="{{ block.id }}">
              <img src="{{ block.settings.box_image | img_url: '300x' }}" alt="{{ block.settings.box_label }}">
              <p>{{ block.settings.box_label }}</p>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <button class="btn btn--primary" data-action="next-step">Choose Your Gifts</button>
    </div>

    <!-- STEP 2 -->
    <div class="step-content hidden" id="step-2">
      <p class="small-label">STEP 2 OF 3</p>
      <h2>CHOOSE YOUR GIFTS</h2>
      <p class="description">We've hand-selected the best gifts in one place. Select from the items below and fill up your gift box!</p>
      <div class="gift-options">
        {% for product in section.settings.gift_products %}
          <div class="option-item" data-product-id="{{ product.id }}">
            <img src="{{ product.featured_image | img_url: '300x' }}" alt="{{ product.title }}">
            <p>{{ product.title }}</p>
            <p class="price">{{ product.price | money }}</p>
          </div>
        {% endfor %}
      </div>
      <aside class="box-summary">
        <h3>Box Content</h3>
        <ul id="summary-list"></ul>
        <p class="subtotal">Box Subtotal: <span id="box-subtotal">{{ section.settings.base_box_price | money }}</span></p>
        <button class="btn btn--primary" data-action="next-step">Choose Your Card</button>
      </aside>
    </div>

    <!-- STEP 3 -->
    <div class="step-content hidden" id="step-3">
      <p class="small-label">STEP 3 OF 3</p>
      <h2>CHOOSE YOUR CARD</h2>
      <p class="description">Choose the perfect card for the occasion from our selection of exclusive designs.</p>
      <div class="card-options">
        {% for block in section.blocks %}
          {% if block.type == 'card_design' %}
            <div class="option-item" data-block-id="{{ block.id }}">
              <img src="{{ block.settings.card_image | img_url: '300x' }}" alt="{{ block.settings.card_label }}">
              <p>{{ block.settings.card_label }}</p>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <button class="btn btn--primary" data-action="next-step">Build My Box</button>
    </div>

    <!-- DONE -->
    <div class="step-content hidden" id="step-4">
      <p class="small-label">DONE!</p>
      <h2>BUILDING YOUR BOX</h2>
      <p>Please wait a moment while we prepare your custom gift box!</p>
      <div class="checkmark-circle">
        <svg viewBox="0 0 52 52" class="checkmark"><path d="M14 27l7 7 16-16"/></svg>
      </div>
      <button class="btn btn--primary" onclick="window.location='{{ routes.cart_url }}';">PROCEED TO CHECKOUT</button>
      <button class="btn btn--secondary" onclick="location.reload();">BUILD ANOTHER BOX</button>
    </div>
  </div>
</div>

<style>
.box-customizer { max-width: 960px; margin: 0 auto; font-family: sans-serif; text-align: center; }
.customizer-icons { display: flex; justify-content: space-between; margin-bottom: 2rem; }
.customizer-icons .icon-step { flex: 1; opacity: .5; transition: opacity .3s; }
.customizer-icons .icon-step.active { opacity: 1; }
.customizer-icons .icon-step img { max-width: 60px; }
.customizer-icons .icon-step p { margin-top: .5rem; font-weight: bold; color: #191E3A; }
.customizer-progress { position: relative; margin-bottom: 3rem; }
.customizer-progress .progress-line { height: 2px; background: #E0E0E0; position: absolute; top: 12px; left: 5%; right: 5%; }
.progress-step { position: relative; display: inline-block; width: 20%; text-align: center; }
.progress-step span.step-label { display: none; font-size: .75rem; color: #AAA; }
.progress-step.active span.step-label { display: block; color: #E00060; font-weight: bold; }
.progress-step::before { content: ''; display: block; width: 16px; height: 16px; background: #E0E0E0; border-radius: 50%; margin: 0 auto; position: relative; top: -8px; }
.progress-step.active::before { background: #E00060; }

.customizer-content .step-content { display: none; }
.customizer-content .step-content:first-child { display: block; }
.customizer-content .step-content.active { display: block; }
.customizer-content .small-label { font-size: .9rem; font-weight: bold; color: #888; margin-bottom: .5rem; }
.customizer-content h2 { font-size: 2rem; margin-bottom: .5rem; }
.customizer-content .description { font-size: 1rem; margin-bottom: 1.5rem; color: #555; }
.option-item { display: inline-block; margin: 0 1rem; cursor: pointer; text-align: center; }
.option-item img { border: 2px solid transparent; border-radius: 8px; transition: border-color .3s; }
.option-item.selected img { border-color: #E00060; }
.option-item p { margin-top: .5rem; font-weight: bold; }
.btn { display: inline-block; padding: .75rem 1.5rem; margin: 1rem auto; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
.btn--primary { background: #191E3A; color: #FFF; }
.btn--secondary { background: transparent; color: #191E3A; border: 2px solid #191E3A; }
.box-options, .gift-options, .card-options { display: flex; flex-wrap: wrap; justify-content: center; }
.box-summary { background: #F9F9F9; padding: 1rem; border-radius: 8px; display: inline-block; width: 260px; vertical-align: top; margin-left: 2rem; }
.box-summary h3 { margin-bottom: .5rem; }
.box-summary ul { list-style: none; padding: 0; margin: 0 0 1rem; }
.box-summary li { margin-bottom: .5rem; text-align: left; }
.box-summary .subtotal { font-weight: bold; }
.checkmark-circle { margin: 2rem auto; width: 80px; height: 80px; border-radius: 50%; background: #E00060; display: flex; align-items: center; justify-content: center; }
.checkmark { stroke: #FFF; stroke-width: 4; fill: none; width: 40px; height: 40px; }
.hidden { display: none !important; }
</style>

<script>
(function(){
  var current = 1;
  function showStep(step) {
    document.querySelectorAll('.icon-step').forEach(el => el.classList.toggle('active', +el.dataset.step === step));
    document.querySelectorAll('.progress-step').forEach(el => el.classList.toggle('active', +el.dataset.step === step));
    document.querySelectorAll('.step-content').forEach(el => el.style.display = (el.id === 'step-'+step) ? 'block' : 'none');
  }
  document.querySelectorAll('[data-action="next-step"]').forEach(btn => {
    btn.addEventListener('click', function(){
      if(current < 4) current++;
      showStep(current);
    });
  });
  // Option selection
  document.querySelectorAll('.option-item').forEach(item => {
    item.addEventListener('click', function(){
      var parent = item.closest('.step-content');
      parent.querySelectorAll('.option-item').forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');
      // update summary for gifts
      if(parent.id === 'step-2') {
        var id = item.dataset.productId;
        var title = item.querySelector('p').innerText;
        var price = item.querySelector('.price').innerText;
        var list = document.getElementById('summary-list');
        list.innerHTML = `<li>${title} - ${price}</li>`;
        document.getElementById('box-subtotal').innerText = price;
      }
    });
  });
})();
</script>

{% schema %}
{
  "name": "Box Customizer",
  "settings": [
    { "type": "number", "id": "base_box_price", "label": "Base Box Price", "default": 21000 },
    { "type": "product_list", "id": "gift_products", "label": "Gift products", "limit": 10 }
  ],
  "blocks": [
    { "type": "box_color", "name": "Box Color Option", "settings": [
        { "type": "image_picker", "id": "box_image", "label": "Box image" },
        { "type": "text", "id": "box_label", "label": "Label" }
      ]
    },
    { "type": "card_design", "name": "Card Design Option", "settings": [
        { "type": "image_picker", "id": "card_image", "label": "Card image" },
        { "type": "text", "id": "card_label", "label": "Label" }
      ]
    }
  ],
  "presets": [ { "name": "Box Customizer" } ]
}
{% endschema %}
