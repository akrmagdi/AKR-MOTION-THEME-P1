{% comment %}
Section: Box Customizer for Shopify
Drop this file into /sections/box-customizer.liquid and add to a page template.
This version uses Font Awesome icons, collection-based product loops for each step, and enhanced hover/selection styling.
{% endcomment %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<div class="box-customizer">
  <!-- ICON NAV -->
  <div class="customizer-icons">
    <div class="icon-step active" data-step="1">
      <i class="fas fa-box-open fa-2x"></i>
      <p>PICK YOUR GIFTBOX</p>
    </div>
    <div class="icon-step" data-step="2">
      <i class="fas fa-gifts fa-2x"></i>
      <p>CHOOSE YOUR GIFTS</p>
    </div>
    <div class="icon-step" data-step="3">
      <i class="fas fa-id-card fa-2x"></i>
      <p>PICK A CARD</p>
    </div>
    <div class="icon-step" data-step="4">
      <i class="fas fa-magic fa-2x"></i>
      <p>ENJOY GIFTING</p>
    </div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="customizer-progress">
    <div class="progress-line"></div>
    {% for i in (1..4) %}
      <div class="progress-step{% if i == 1 %} active{% endif %}" data-step="{{ i }}">
        <span class="step-label">
          {% case i %}
            {% when 1 %}STEP 1<br>Packaging
            {% when 2 %}STEP 2<br>Gifts
            {% when 3 %}STEP 3<br>Card
            {% when 4 %}DONE<br>Done!
          {% endcase %}
        </span>
      </div>
    {% endfor %}
  </div>

  <!-- STEP CONTENT -->
  <div class="customizer-content">
    <!-- STEP 1 -->
    <div class="step-content active" id="step-1">
      <p class="small-label">STEP 1 OF 3</p>
      <h2>CHOOSE YOUR BOX COLOR</h2>
      <p class="description">Welcome to the easiest way to send someone a custom gift, in 3 simple steps. Add to cart and repeat for multiple boxes, or update your quantity in the cart.</p>
      <div class="box-options">
        {% for product in collections[section.settings.packaging_collection].products %}
          <div class="option-item" data-product-id="{{ product.id }}">
            <img src="{{ product.featured_image | img_url: '300x' }}" alt="{{ product.title }}">
            <p>{{ product.title }}</p>
          </div>
        {% endfor %}
      </div>
      <button class="btn btn--primary" data-action="next-step">Choose Your Gifts</button>
    </div>

    <!-- STEP 2 -->
    <div class="step-content hidden" id="step-2">
      <p class="small-label">STEP 2 OF 3</p>
      <h2>CHOOSE YOUR GIFTS</h2>
      <p class="description">We've hand-selected the best gifts in one place. Select from the items below and fill up your gift box!</p>
      <div class="gift-options">
        {% for product in collections[section.settings.gifts_collection].products %}
          <div class="option-item" data-product-id="{{ product.id }}">
            <img src="{{ product.featured_image | img_url: '300x' }}" alt="{{ product.title }}">
            <p>{{ product.title }}</p>
            <p class="price">{{ product.price | money }}</p>
          </div>
        {% endfor %}
      </div>
      <aside class="box-summary">
        <h3>Box Content</h3>
        <ul id="summary-list"></ul>
        <p class="subtotal">Box Subtotal: <span id="box-subtotal">{{ section.settings.base_box_price | money }}</span></p>
        <button class="btn btn--primary" data-action="next-step">Choose Your Card</button>
      </aside>
    </div>

    <!-- STEP 3 -->
    <div class="step-content hidden" id="step-3">
      <p class="small-label">STEP 3 OF 3</p>
      <h2>CHOOSE YOUR CARD</h2>
      <p class="description">Choose the perfect card for the occasion from our selection of exclusive designs.</p>
      <div class="card-options">
        {% for product in collections[section.settings.cards_collection].products %}
          <div class="option-item" data-product-id="{{ product.id }}">
            <img src="{{ product.featured_image | img_url: '300x' }}" alt="{{ product.title }}">
            <p>{{ product.title }}</p>
            <p class="price">{{ product.price | money }}</p>
          </div>
        {% endfor %}
      </div>
      <button class="btn btn--primary" data-action="next-step">Build My Box</button>
    </div>

    <!-- DONE -->
    <div class="step-content hidden" id="step-4">
      <p class="small-label">DONE!</p>
      <h2>BUILDING YOUR BOX</h2>
      <p>Please wait a moment while we prepare your custom gift box!</p>
      <div class="checkmark-circle">
        <svg viewBox="0 0 52 52" class="checkmark"><path d="M14 27l7 7 16-16"/></svg>
      </div>
      <button class="btn btn--primary" onclick="window.location='{{ routes.cart_url }}';">PROCEED TO CHECKOUT</button>
      <button class="btn btn--secondary" onclick="location.reload();">BUILD ANOTHER BOX</button>
    </div>
  </div>
</div>

<style>
.box-customizer { max-width: 960px; margin: 0 auto; padding: 2rem 1rem; font-family: sans-serif; text-align: center; }
.customizer-icons { display: flex; justify-content: space-between; margin-bottom: 2rem; }
.icon-step { flex: 1; opacity: .5; transition: opacity .3s, transform .3s; cursor: pointer; }
.icon-step.active, .icon-step:hover { opacity: 1; transform: translateY(-4px); }
.icon-step i { color: #191E3A; }
.icon-step p { margin-top: .5rem; font-weight: bold; color: #191E3A; }
.customizer-progress { position: relative; margin-bottom: 3rem; }
.progress-line { height: 2px; background: #E0E0E0; position: absolute; top: 12px; left: 5%; right: 5%; }
.progress-step { position: relative; display: inline-block; width: 20%; text-align: center; }
.progress-step::before { content: ''; display: block; width: 16px; height: 16px; background: #E0E0E0; border-radius: 50%; margin: 0 auto; position: relative; top: -8px; transition: background .3s; }
.progress-step.active::before { background: #E00060; }
.step-label { display: none; font-size: .75rem; color: #AAA; }
.progress-step.active .step-label { display: block; color: #E00060; font-weight: bold; }

.step-content { display: none; }
.step-content.active { display: block; }
.small-label { font-size: .9rem; font-weight: bold; color: #888; margin-bottom: .5rem; }
h2 { font-size: 2rem; margin-bottom: .5rem; }
.description { font-size: 1rem; margin-bottom: 1.5rem; color: #555; }
.option-item { display: inline-block; margin: 0 1rem; cursor: pointer; text-align: center; transition: transform .3s; }
.option-item img { border: 2px solid transparent; border-radius: 8px; transition: transform .3s, border-color .3s, box-shadow .3s; }
.option-item:hover img { transform: scale(1.1); }
.option-item.selected img { border-color: #E00060; box-shadow: 0 4px 12px rgba(224,0,96,0.3); }
.option-item p { margin-top: .5rem; font-weight: bold; }
.price { color: #191E3A; font-weight: bold; }
.btn { display: inline-block; padding: .75rem 1.5rem; margin: 1rem auto; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: opacity .3s; }
.btn--primary { background: #191E3A; color: #FFF; }
.btn--primary:hover { opacity: .85; }
.btn--secondary { background: transparent; color: #191E3A; border: 2px solid #191E3A; }
.box-options, .gift-options, .card-options { display: flex; flex-wrap: wrap; justify-content: center; }
.box-summary { background: #F9F9F9; padding: 1rem; border-radius: 8px; display: inline-block; width: 260px; vertical-align: top; margin-left: 2rem; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.box-summary h3 { margin-bottom: .5rem; }
.box-summary ul { list-style: none; padding: 0; margin: 0 0 1rem; text-align: left; }
.box-summary li { margin-bottom: .5rem; }
.subtotal { font-weight: bold; }
.checkmark-circle { margin: 2rem auto; width: 80px; height: 80px; border-radius: 50%; background: #E00060; display: flex; align-items: center; justify-content: center; }
.checkmark { stroke: #FFF; stroke-width: 4; fill: none; width: 40px; height: 40px; }
.hidden { display: none !important; }
</style>

<script>
(function(){
  var current = 1;
  function showStep(step) {
    current = step;
    document.querySelectorAll('.icon-step').forEach(el => el.classList.toggle('active', +el.dataset.step === step));
    document.querySelectorAll('.progress-step').forEach(el => el.classList.toggle('active', +el.dataset.step === step));
    document.querySelectorAll('.step-content').forEach(el => el.classList.toggle('active', el.id === 'step-'+step));
  }
  document.querySelectorAll('[data-action="next-step"]').forEach(btn => {
    btn.addEventListener('click', function(){ if(current < 4) showStep(current+1); });
  });
  document.querySelectorAll('.option-item').forEach(item => {
    item.addEventListener('click', function(){
      var pane = item.closest('.step-content');
      pane.querySelectorAll('.option-item').forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');
      if(pane.id === 'step-2') {
        var title = item.querySelector('p').innerText;
        var price = item.querySelector('.price').innerText;
        document.getElementById('summary-list').innerHTML = `<li>${title} - ${price}</li>`;
        document.getElementById('box-subtotal').innerText = price;
      }
    });
  });
})();
</script>

{% schema %}
{
  "name": "Box Customizer",
  "settings": [
    { "type": "collection", "id": "packaging_collection", "label": "Packaging Collection" },
    { "type": "collection", "id": "gifts_collection", "label": "Gifts Collection" },
    { "type": "collection", "id": "cards_collection", "label": "Cards Collection" },
    { "type": "number", "id": "base_box_price", "label": "Base Box Price", "default": 21000 }
  ],
  "presets": [ { "name": "Box Customizer" } ]
}
{% endschema %}
